var handwriting;var canvas;var previousOrientation;var viewPortWidth;var viewPortHeight;var undoStack=[];var redoStack=[];function previewFile(){var file=document.querySelector("input[type=file]").files[0];var reader=new FileReader;reader.onloadend=function(){var image=document.getElementById("canvas-background");image.src=reader.result;image.onload=function(){if(canvas)document.getElementById("draw-card-canvas").removeChild(canvas);var scaleX=viewPortWidth/image.width;var scaleY=viewPortHeight/image.height;var scaleFactor=scaleX>scaleY?scaleY:scaleX;var newWidth=image.width*scaleFactor;var newHeight=image.height*scaleFactor;image.width=newWidth;image.height=newHeight;init(newWidth,newHeight);$(".button-tool").css("visibility","visible")}};if(file){reader.readAsDataURL(file)}}function setupButtons(){$("#undo").click(function(e){if(undoStack.length==0)return;e.preventDefault();redoStack.push(undoStack.pop());if(undoStack.length>0)handwriting.fromDataURL(undoStack[undoStack.length-1]);else handwriting.clear()});$("#redo").click(function(e){if(redoStack.length==0){return}e.preventDefault();var data=redoStack.pop();undoStack.push(data);handwriting.fromDataURL(data)});$("#save").click(function(e){e.preventDefault();var url=handwriting.toDataURL().replace(/^data:image\/[^;]/,"data:application/octet-stream");window.open(url)})}function init(canvasWidth,canvasHeight){var canvasDiv=document.getElementById("draw-card-canvas");canvas=document.createElement("canvas");canvas.setAttribute("width",canvasWidth);canvas.setAttribute("height",canvasHeight);canvas.setAttribute("id","canvas");canvasDiv.appendChild(canvas);if(typeof G_vmlCanvasManager!="undefined"){canvas=G_vmlCanvasManager.initElement(canvas)}context=canvas.getContext("2d");handwriting=new Handwriting(canvas);handwriting.onEnd=function(){redoStack.length=0;undoStack.push(handwriting.toDataURL());if(undoStack.length>10){undoStack.shift()}}}function getViewport(){if(typeof window.innerWidth!="undefined"){viewPortWidth=window.innerWidth;viewPortHeight=window.innerHeight}else if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0){viewPortWidth=document.documentElement.clientWidth;viewPortHeight=document.documentElement.clientHeight}else{viewPortWidth=document.getElementsByTagName("body")[0].clientWidth;viewPortHeight=document.getElementsByTagName("body")[0].clientHeight}return[viewPortWidth,viewPortHeight]}var checkOrientation=function(){if(window.orientation!==previousOrientation){previousOrientation=window.orientation;getViewport()}};setInterval(checkOrientation,2e3);$(document).ready(function(){setupButtons();getViewport();previousOrientation=window.orientation;window.addEventListener("resize",checkOrientation,false);window.addEventListener("orientationchange",checkOrientation,false)});