function loadCarousel(){$("#carousel").owlCarousel({margin:10,loop:!0,autoWidth:!0,items:4}),owl=$("#carousel").data("owl.carousel")}function chooseImage(t){var e=document.getElementById("canvas-background");e&&e.remove(),e=document.createElement("img"),e.setAttribute("id","canvas-background"),document.getElementById("stacked").appendChild(e),e.src=t,$(e).css("visibility","invisible"),e.onload=function(){canvas&&document.getElementById("draw-card-canvas").removeChild(canvas);var t=viewPortWidth/e.width,n=viewPortHeight/e.height,i=t>n?n:t,a=e.width*i,o=e.height*i;e.width=a,e.height=o,init(a,o),$(e).css("visibility","visible"),$(".button-tool").css("visibility","visible")}}function previewFile(){var t=document.querySelector("input[type=file]").files[0],e=new FileReader;e.onloadend=function(){owl.add('<div class="item"> <img onclick="chooseImage(this.src)" class="lazyOwl" src="'+e.result+'"></img></div>',0)},t&&e.readAsDataURL(t)}function setupButtons(){$("#undo").click(function(t){0!=undoStack.length&&(t.preventDefault(),redoStack.push(undoStack.pop()),undoStack.length>0?handwriting.fromDataURL(undoStack[undoStack.length-1]):handwriting.clear())}),$("#redo").click(function(t){if(0!=redoStack.length){t.preventDefault();var e=redoStack.pop();undoStack.push(e),handwriting.fromDataURL(e)}}),$("#save").click(function(t){t.preventDefault(),$(".output").remove();var e=handwriting.toDataURL().replace(/^data:image\/[^;]/,"data:application/octet-stream");$("#buttons").append($("<a class='output' download='output.png' href='"+e+"' title='output.png'><button class='btn btn-default button-tool' style='visibility: visible;'>PNG</button></a>"));var n="data:application/octet-streamng;base64,"+btoa(unescape(encodeURIComponent(handwriting.toSVG())));$("#buttons").append($("<a class='output' download='output.svg' href='"+n+"' title='output.svg'><button class='btn btn-default button-tool' style='visibility: visible;'>SVG</button></a>"))})}function init(t,e){var n=document.getElementById("draw-card-canvas");canvas=document.createElement("canvas"),canvas.setAttribute("width",t),canvas.setAttribute("height",e),canvas.setAttribute("id","canvas"),n.setAttribute("width",t),n.setAttribute("height",e),n.appendChild(canvas),"undefined"!=typeof G_vmlCanvasManager&&(canvas=G_vmlCanvasManager.initElement(canvas)),handwriting=new Handwriting(canvas),handwriting.onEnd=function(){redoStack.length=0,undoStack.push(handwriting.toDataURL()),undoStack.length>10&&undoStack.shift()}}function updateViewPort(){"undefined"!=typeof window.innerWidth?(viewPortWidth=window.innerWidth,viewPortHeight=window.innerHeight):"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth&&0!=document.documentElement.clientWidth?(viewPortWidth=document.documentElement.clientWidth,viewPortHeight=document.documentElement.clientHeight):(viewPortWidth=document.getElementsByTagName("body")[0].clientWidth,viewPortHeight=document.getElementsByTagName("body")[0].clientHeight)}for(var handwriting,canvas,owl,previousOrientation,viewPortWidth,viewPortHeight,undoStack=[],redoStack=[],num=1;14>=num;num++)$(".owl-carousel").append('<div class="item"> <img onclick="chooseImage(this.src)" class="lazyOwl" src="./samples/fullsize-'+num+'.jpg"></img></div>');var checkOrientation=function(){window.orientation!==previousOrientation&&(previousOrientation=window.orientation),updateViewPort()};setInterval(checkOrientation,2e3),$(document).ready(function(){setupButtons(),updateViewPort(),loadCarousel(),previousOrientation=window.orientation,window.addEventListener("resize",checkOrientation,!1),window.addEventListener("orientationchange",checkOrientation,!1)});